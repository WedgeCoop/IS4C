<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CORE POS - Fannie: FannieReportPage2 Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <form id="FSearchBox" action="search.php" method="get">
            <img id="MSearchSelect" src="search/search.png" alt=""/>
            <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                   onfocus="searchBox.OnSearchFieldFocus(true)" 
                   onblur="searchBox.OnSearchFieldFocus(false)"/>
          </form>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>FannieReportPage2 Class Reference</h1><!-- doxytag: class="FannieReportPage2" --><!-- doxytag: inherits="FannieReportPage" --><div class="dynheader">
Inheritance diagram for FannieReportPage2:</div>
<div class="dynsection">
 <div class="center">
  <img src="class_fannie_report_page2.png" usemap="#FannieReportPage2_map" alt=""/>
  <map id="FannieReportPage2_map" name="FannieReportPage2_map">
<area href="class_fannie_report_page.html" alt="FannieReportPage" shape="rect" coords="141,56,272,80"/>
<area href="class_fannie_page.html" alt="FanniePage" shape="rect" coords="70,0,201,24"/>
<area href="class_fannie_page.html" alt="FanniePage" shape="rect" coords="211,0,342,24"/>
<area href="class_store_summary_report.html" alt="StoreSummaryReport" shape="rect" coords="0,168,131,192"/>
<area href="class_store_summary_report.html" alt="StoreSummaryReport" shape="rect" coords="141,168,272,192"/>
<area href="class_store_summary_report.html" alt="StoreSummaryReport" shape="rect" coords="282,168,413,192"/>
</map>
 </div>
</div>

<p><a href="class_fannie_report_page2-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fannie_report_page2.html#a25ac4f5b9600037a637139fac0119a57">report_content</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fannie_report_page2.html#a0c1957b8581e201b746ac4e3a7fbf0a7">render_data</a> ($data, $headers=array(), $footers=array(), $format='html')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fannie_report_page2.html#a236bde8ccb2bb26f5d1cdde68306eee3">html_line</a> ($row, $header=False, $footer=False)</td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6e5e569dc9b1ae76b799603d3b49bf45"></a><!-- doxytag: member="FannieReportPage2::$required" ref="a6e5e569dc9b1ae76b799603d3b49bf45" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>$required</b> = True</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><b>$description</b></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fannie_report_page2.html#a05752b717206accfa8f9d70e6c2ac4e3">$summary_data</a> = array()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7c0f5ff24c0f1a6a09616ece15e5e66e"></a><!-- doxytag: member="FannieReportPage2::$summary_counter" ref="a7c0f5ff24c0f1a6a09616ece15e5e66e" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>$summary_counter</b> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaf636223075684a471372486d91764f5"></a><!-- doxytag: member="FannieReportPage2::$number_of_summaries" ref="aaf636223075684a471372486d91764f5" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>$number_of_summaries</b> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fannie_report_page2.html#abbf36daef07b9f9be0304ef51c6ea144">$number_of_reports</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fannie_report_page2.html#a6e54879a417948779207b2df3f9e02ec">$cellTextAlign</a> = ''</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Class for drawing screens </p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a236bde8ccb2bb26f5d1cdde68306eee3"></a><!-- doxytag: member="FannieReportPage2::html_line" ref="a236bde8ccb2bb26f5d1cdde68306eee3" args="($row, $header=False, $footer=False)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FannieReportPage2::html_line </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>row</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>header</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>footer</em> = <code>False</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Convert keyed array to numerical indexes and maintain order</p>
<p>function dekey_array($arr){ $ret = array(); foreach($arr as $outer_key =&gt; $row){ $record = array(); foreach($row as $key =&gt; $val) $record[] = $val; $ret[] = $record; } return $ret; } No change. Turn array into HTML table row </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$row</em>&nbsp;</td><td>an array of data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$header</em>&nbsp;</td><td>True means </td></tr>
  </table>
  </dd>
</dl>
<p>tags, False means </p>
<p>tags </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>HTML string</dd></dl>
<p>Javascript sorting utility requires header rows to be </p>
<p>tags Changed. </p>

</div>
</div>
<a class="anchor" id="a0c1957b8581e201b746ac4e3a7fbf0a7"></a><!-- doxytag: member="FannieReportPage2::render_data" ref="a0c1957b8581e201b746ac4e3a7fbf0a7" args="($data, $headers=array(), $footers=array(), $format='html')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FannieReportPage2::render_data </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>headers</em> = <code>array()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>footers</em> = <code>array()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>format</em> = <code>'html'</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Calculate a footer row </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$data</em>&nbsp;</td><td>an two-dimensional array of data </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>array of footer values</dd></dl>
<p>Principally, footers are separate from data so they can be marked in such in HTML rendering and stay at the bottom when data sorting changes.</p>
<p>This function may also be used to set values for headers or default sorting. On more elaborate reports, the number of columns may vary depending on what options are selected. This function is always called so those values will be set reliably even if caching is enabled. function calculate_footers($data){ return array(); } No change. Look for cached SQL data</p>
<p>Data is stored in the archive database, reportDataCache table.</p>
<p>The key column is an MD5 hash of the current URL (minus the excel parameter, if present). This means your forms should use type GET if caching is enabled.</p>
<p>The data is stored as a serialized, gzcompressed string. function <a class="el" href="class_fannie_report_page.html#a753adb4fb792feab94456740a73cdbd2">check_data_cache()</a>{ global $dbc,$FANNIE_ARCHIVE_DB; if ($this-&gt;report_cache != 'day' &amp;&amp; $this-&gt;report_cache != 'month') return False; $table = $FANNIE_ARCHIVE_DB.$dbc-&gt;sep()."reportDataCache"; $hash = $_SERVER['REQUEST_URI']; $hash = str_replace("&amp;excel=xls","",$hash); $hash = str_replace("&amp;excel=csv","",$hash); $hash = md5($hash); $query = $dbc-&gt;prepare_statement("SELECT report_data FROM $table WHERE
			hash_key=? AND expires &gt;= ".$dbc-&gt;now()); $result = $dbc-&gt;exec_statement($query,array($hash)); if ($dbc-&gt;num_rows($result) &gt; 0) return array_pop($dbc-&gt;fetch_row($result)); else return False; } No change. Store SQL data in the cache </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$data</em>&nbsp;</td><td>the data </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>True or False based on success</dd></dl>
<p>See check_data_cache for details function freshen_cache($data){ global $dbc,$FANNIE_ARCHIVE_DB; if ($this-&gt;report_cache != 'day' &amp;&amp; $this-&gt;report_cache != 'month') return False; $table = $FANNIE_ARCHIVE_DB.$dbc-&gt;sep()."reportDataCache"; $hash = $_SERVER['REQUEST_URI']; $hash = str_replace("&amp;excel=xls","",$hash); $hash = str_replace("&amp;excel=csv","",$hash); $hash = md5($hash); $expires = ''; if ($this-&gt;report_cache == 'day') $expires = date('Y-m-d',mktime(0,0,0,date('n'),date('j')+1,date('Y'))); elseif ($this-&gt;report_cache == 'month') $expires = date('Y-m-d',mktime(0,0,0,date('n')+1,date('j'),date('Y')));</p>
<p>$delQ = $dbc-&gt;prepare_statement("DELETE FROM $table WHERE hash_key=?"); $dbc-&gt;exec_statement($delQ,array($hash)); $upQ = $dbc-&gt;prepare_statement("INSERT INTO $table (hash_key, report_data, expires)
			VALUES (?,?,?)"); $dbc-&gt;exec_statement($upQ, array($hash, gzcompress(serialize($data)), $expires)); return True; } No change. Extra, non-tabular information prepended to reports </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>array of strings</dd></dl>
<p>function <a class="el" href="class_fannie_report_page.html#ad39eee2e7648b187042d9fcb3952986b">report_description_content()</a>{ return array(); } No change. Get the report data </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a two dimensional array</dd></dl>
<p>Actual SQL queries go here!</p>
<p>If using multi_report_mode, this should return an array of two dimensional arrays where each two dimensional arrays contains a report's data.</p>
<p>function <a class="el" href="class_fannie_report_page.html#ad25b4fae1d8babee7e2460f621ee8505">fetch_report_data()</a>{</p>
<p>} No change. Format data for one report for display </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$data</em>&nbsp;</td><td>a two dimensional array of data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$headers</em>&nbsp;</td><td>a header row (optional) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$footers</em>&nbsp;</td><td>a column-totals row (optional) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$format</em>&nbsp;</td><td>output format (html | xls | csv) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>formatted string Changed. </dd></dl>

<p>Reimplemented from <a class="el" href="class_fannie_report_page.html#a84569cf5e732eefc5d09e74336554f40">FannieReportPage</a>.</p>

</div>
</div>
<a class="anchor" id="a25ac4f5b9600037a637139fac0119a57"></a><!-- doxytag: member="FannieReportPage2::report_content" ref="a25ac4f5b9600037a637139fac0119a57" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FannieReportPage2::report_content </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle pre-display tasks such as input processing </p>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>True if the page should be displayed</li>
<li>False to stop here</li>
</ul>
</dd></dl>
<p>Typically in a report this checks for posted data and decides between showing a data entry form or the report results. function <a class="el" href="class_fannie_report_page.html#a3a76c828a228dcab21752fc71d3c2566">preprocess()</a>{ return True; } No change. Define the data input form </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>An HTML string function <a class="el" href="class_fannie_report_page.html#a0f6e984ef8a1d9b365b7ab68fe20fcd5">form_content()</a>{</dd></dl>
<p>} No change. Define the report display, all the reports and summaries on the page </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>An HTML string (echoes, doesn't return)</dd></dl>
<p>Generally this function is not overriden.</p>
<p>This will first check the cache to see if data for this report has been saved. If not, it will look up the data by calling the fetch_report_data function. That function should be overriden. fetch_report_data can optionally return summary report data in separate array.</p>
<p>Once the data is retrieved, this will call the calculate_footers function on the data. Footers are not required, but it's useful for some final calculations.</p>
<p>Finally, the render_data function is called. Overriding that is not recommended. Changed. </p>

<p><p>For XLS ouput, re-assemble multiple reports into a single long dataset.</p>
</p>

<p>Reimplemented from <a class="el" href="class_fannie_report_page.html#a7697cb339cb08524d4ef5f3d7cf47f2c">FannieReportPage</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a6e54879a417948779207b2df3f9e02ec"></a><!-- doxytag: member="FannieReportPage2::$cellTextAlign" ref="a6e54879a417948779207b2df3f9e02ec" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FannieReportPage2::$cellTextAlign = ''<code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Option to enable/disable javascript sorting protected $sortable = True; Which column to sort by default protected $sort_column = 0; Sort direction. 0 is ascending, 1 is descending protected $sort_direction = 0; Alignment of table cell text. Valid values are: '' 'left' 'right' </p>

</div>
</div>
<a class="anchor" id="a299e5ef46b33e6549eb0ea72ec1c2ad7"></a><!-- doxytag: member="FannieReportPage2::$description" ref="a299e5ef46b33e6549eb0ea72ec1c2ad7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FannieReportPage2::$description</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> <span class="stringliteral">&quot;</span>
<span class="stringliteral">        Base class for creating reports.</span>
<span class="stringliteral">        Formats non-sortable multi-section report as single table.</span>
<span class="stringliteral">        &quot;</span>
</pre></div>
<p>Reimplemented from <a class="el" href="class_fannie_report_page.html">FannieReportPage</a>.</p>

</div>
</div>
<a class="anchor" id="abbf36daef07b9f9be0304ef51c6ea144"></a><!-- doxytag: member="FannieReportPage2::$number_of_reports" ref="abbf36daef07b9f9be0304ef51c6ea144" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FannieReportPage2::$number_of_reports = 0<code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Define report format. Valid values are: html, xls, csv protected $report_format = 'html'; Enable caching of SQL data. Valid values are: none, day, month protected $report_cache = 'none'; Allow for reports that contain multiple separate tables of data protected $multi_report_mode = False; protected $multi_counter = 1; </p>

<p>Reimplemented from <a class="el" href="class_fannie_report_page.html">FannieReportPage</a>.</p>

</div>
</div>
<a class="anchor" id="a05752b717206accfa8f9d70e6c2ac4e3"></a><!-- doxytag: member="FannieReportPage2::$summary_data" ref="a05752b717206accfa8f9d70e6c2ac4e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FannieReportPage2::$summary_data = array()<code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function for drawing page content. form_content and report_content are provided by default. protected $content_function = "form_content"; Define report headers. Headers are necessary if sorting is desired protected $report_headers = array(); End-of report summary(ies), with integrated headers. (optional) Two-dimensional, as for body data. Same number of columns as body data. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>fannie/classlib2.0/FannieReportPage2.php</li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Aug 9 21:30:09 2013 for CORE POS - Fannie by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
