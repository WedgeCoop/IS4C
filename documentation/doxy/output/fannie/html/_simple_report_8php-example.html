<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CORE POS - Fannie: SimpleReport.php</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>SimpleReport.php</h1>This is a an example of a typical report. Many reports follow this general format with one screen where a user can enter some values and a second screen that shows the generated report.<p>
The report_form() method creates the screen where a user can enter report parameters. This method should return an HTML string, but output buffering can be used as shown if you want to include raw HTML. Note the use of <a class="el" href="class_fannie_page.html#517d90f03fa855837eb94dacce7d39d8">FanniePage::form_tag()</a>. This is ensures your module will receive the form input.<p>
The report_results() method cretes the screen where with the generated report. Like report_form(), it returns an HTML string. This is by no means the only way to generate results, but it demonstrates some useful functions:<ul>
<li><b>get_form_value</b> fetches input from $_GET or $_POST and you don't have to worry about which. The second argument sets a default value in case the form value doesn't exist.</li><li><b>op_connect</b> provides a database connection</li><li><b>get_sortable_table</b> builds an HTML table from a query. The table can is sortable by the column headers. $columns demonstrates how columns are defined and some of the formatting options.</li><li>FannieReport::Download() generates proper headers to output the report as a downloadable file</li></ul>
<p>
The preprocess() function simply changes the mode if a form submission is detected. Mode control which of the above screens is shown. Disabling window_dressing removes Fannie's normal header, menu, and footer. This is useful with wide reports that have many columns and vital if you're going to use FannieReport::Download(). Excel can read a simple HTML table, but a full HTML page with CSS styling and lots of divs won't work well.<p>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keyword">class </span>SimpleReport <span class="keyword">extends</span> <a name="_a9"></a><a class="code" href="class_fannie_report.html">FannieReport</a> {
<a name="l00004"></a>00004 
<a name="l00005"></a>00005         <span class="keyword">public</span> $description = <span class="stringliteral">"Report products in a department"</span>;
<a name="l00006"></a>00006         <span class="keyword">protected</span> $title = <span class="stringliteral">"Simple Report"</span>;
<a name="l00007"></a>00007         <span class="keyword">protected</span> $header = <span class="stringliteral">"Fannie :: Simple Report"</span>;
<a name="l00008"></a>00008 
<a name="l00009"></a>00009         function <a name="a10"></a><a class="code" href="class_fannie_report.html#864352cfdcaa469a698548dc3473d363">report_form</a>(){
<a name="l00010"></a>00010                 ob_start();
<a name="l00011"></a>00011                 echo $this-&gt;<a name="a11"></a><a class="code" href="class_fannie_page.html#517d90f03fa855837eb94dacce7d39d8">form_tag</a>();
<a name="l00012"></a>00012                 ?&gt;
<a name="l00013"></a>00013                 Enter department number:
<a name="l00014"></a>00014                 &lt;input type=<span class="stringliteral">"text"</span> size=<span class="stringliteral">"4"</span> name=<span class="stringliteral">"department"</span> /&gt;
<a name="l00015"></a>00015                 &lt;input type=<span class="stringliteral">"submit"</span> name=<span class="stringliteral">"submit"</span> value=<span class="stringliteral">"Run Report"</span> /&gt;
<a name="l00016"></a>00016                 &lt;/form&gt;
<a name="l00017"></a>00017                 &lt;?php
<a name="l00018"></a>00018                 <span class="keywordflow">return</span> ob_get_clean();
<a name="l00019"></a>00019         }
<a name="l00020"></a>00020 
<a name="l00021"></a>00021         function <a name="a12"></a><a class="code" href="class_fannie_report.html#33fd2026b4a39596835186cbf42c0e43">report_results</a>(){
<a name="l00022"></a>00022                 $department = <a name="a13"></a><a class="code" href="_fannie_page_8php.html#b3f2457d96720999b410fb55e398a5e1">get_form_value</a>('department', 0);
<a name="l00023"></a>00023                 $order = <a class="code" href="_fannie_page_8php.html#b3f2457d96720999b410fb55e398a5e1">get_form_value</a>('order', 'upc');
<a name="l00024"></a>00024                 $dir = <a class="code" href="_fannie_page_8php.html#b3f2457d96720999b410fb55e398a5e1">get_form_value</a>('dir', 'ASC');
<a name="l00025"></a>00025                 $excel = <a class="code" href="_fannie_page_8php.html#b3f2457d96720999b410fb55e398a5e1">get_form_value</a>('excel', False);
<a name="l00026"></a>00026 
<a name="l00027"></a>00027                 $dbc = op_connect();
<a name="l00028"></a>00028                 $query = <span class="stringliteral">"SELECT upc, description, normal_price, modified</span>
<a name="l00029"></a>00029 <span class="stringliteral">                        FROM products WHERE department=$department</span>
<a name="l00030"></a>00030 <span class="stringliteral">                        ORDER BY $order $dir"</span>;
<a name="l00031"></a>00031                 $columns = array(
<a name="l00032"></a>00032                         'UPC' =&gt; array('col' =&gt; 'upc'),
<a name="l00033"></a>00033                         'Description' =&gt; array('col' =&gt; 'description'),
<a name="l00034"></a>00034                         'Price' =&gt; array('col' =&gt; 'normal_price',
<a name="l00035"></a>00035                                          'align' =&gt; 'right',
<a name="l00036"></a>00036                                          'format' =&gt; '%.2f'),
<a name="l00037"></a>00037                         'Last Modified' =&gt; array('col' =&gt; 'modified',
<a name="l00038"></a>00038                                                  'date' =&gt; 'm/d/Y')
<a name="l00039"></a>00039                 );
<a name="l00040"></a>00040 
<a name="l00041"></a>00041                 $report = <a name="a14"></a><a class="code" href="_fannie_report_8php.html#c4b2aa0fe8cef592c982223cea34530c">get_sortable_table</a>($dbc, $query, $columns,
<a name="l00042"></a>00042                                 $this-&gt;<a name="a15"></a><a class="code" href="class_fannie_page.html#2e5969e202f6d446c7b9c4f3975e4c6b">module_url</a>(), $order, $excel);   
<a name="l00043"></a>00043 
<a name="l00044"></a>00044                 <span class="keywordflow">if</span> ($excel){
<a name="l00045"></a>00045                         $this-&gt;<a name="a16"></a><a class="code" href="class_fannie_report.html#52f52fdcf4b5aa1b60b89b4867a317c5">download</a>('report.xls', 'excel');
<a name="l00046"></a>00046                 }
<a name="l00047"></a>00047 
<a name="l00048"></a>00048                 $dbc-&gt;close();
<a name="l00049"></a>00049                 <span class="keywordflow">return</span> $report;
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         function <a name="a17"></a><a class="code" href="class_fannie_page.html#2d504e8f61746ef2e5c05cbb90f0f336">preprocess</a>(){
<a name="l00053"></a>00053                 <span class="keywordflow">if</span> (isset($_REQUEST['submit'])){
<a name="l00054"></a>00054                         $this-&gt;mode = 'results';
<a name="l00055"></a>00055                         $this-&gt;window_dressing = False;
<a name="l00056"></a>00056                 }
<a name="l00057"></a>00057         }
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 ?&gt;
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Apr 26 12:39:03 2012 for CORE POS - Fannie by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
